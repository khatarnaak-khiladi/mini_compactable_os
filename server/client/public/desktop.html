<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My_OS - Web Desktop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            user-select: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
        }

        .desktop {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: 
                radial-gradient(circle at 20% 80%, #120c56 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, #ff6b6b 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, #4ecdc4 0%, transparent 50%),
                linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
        }

        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            padding: 0 10px;
            z-index: 1000;
        }

        .start-button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin-right: 10px;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .start-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .taskbar-apps {
            display: flex;
            gap: 5px;
            flex: 1;
        }

        .taskbar-time {
            color: white;
            font-size: 14px;
            margin-left: auto;
        }

        .system-tray {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 15px;
            color: white;
        }

        .system-tray-item {
            cursor: pointer;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 16px;
            transition: all 0.2s ease;
            position: relative;
        }

        .system-tray-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .system-tray-item.active {
            background: rgba(76, 175, 80, 0.8);
        }

        .system-tray-item.low {
            background: rgba(255, 152, 0, 0.8);
        }

        .system-tray-item.critical {
            background: rgba(244, 67, 54, 0.8);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }

        .system-panel {
            position: fixed;
            bottom: 60px;
            right: 10px;
            width: 320px;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 20px;
            display: none;
            color: white;
            z-index: 2000;
        }

        .system-panel.active {
            display: block;
        }

        .system-panel-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .system-panel-section:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .system-panel-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #fff;
        }

        .system-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
        }

        .system-toggle {
            width: 50px;
            height: 24px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .system-toggle.active {
            background: #4caf50;
        }

        .system-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .system-toggle.active::after {
            transform: translateX(26px);
        }

        .system-slider {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        .system-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #4caf50;
            border-radius: 50%;
            cursor: pointer;
        }

        .status-indicator {
            font-size: 12px;
            opacity: 0.8;
        }

        .battery-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .battery-bar {
            width: 60px;
            height: 12px;
            border: 2px solid white;
            border-radius: 2px;
            position: relative;
            background: rgba(255, 255, 255, 0.1);
        }

        .battery-bar::after {
            content: '';
            position: absolute;
            right: -4px;
            top: 3px;
            width: 2px;
            height: 6px;
            background: white;
            border-radius: 0 1px 1px 0;
        }

        .battery-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 1px;
            transition: all 0.3s ease;
        }

        .temperature-indicator {
            text-align: center;
        }

        .temp-gauge {
            width: 40px;
            height: 80px;
            border: 2px solid white;
            border-radius: 20px;
            position: relative;
            background: linear-gradient(to top, #2196f3 0%, #4caf50 50%, #ff9800 80%, #f44336 100%);
            margin: 0 auto 10px;
        }

        .temp-level {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 18px;
            transition: height 0.3s ease;
        }

        .desktop-icons {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .desktop-icon {
            width: 80px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .desktop-icon:hover {
            transform: scale(1.1);
        }

        .desktop-icon .icon {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .desktop-icon .label {
            color: white;
            font-size: 12px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .window {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
            display: none;
            min-width: 400px;
            min-height: 300px;
        }

        .window.active {
            display: block;
        }

        .window-header {
            background: rgba(0, 0, 0, 0.05);
            padding: 10px 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }

        .window-title {
            font-weight: 600;
            color: #333;
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .window-control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
        }

        .window-control.close { background: #ff5f56; }
        .window-control.minimize { background: #ffbd2e; }
        .window-control.maximize { background: #27ca3f; }

        .window-content {
            padding: 20px;
            height: calc(100% - 51px);
            overflow-y: auto;
        }

        .file-explorer {
            display: flex;
            height: 100%;
        }

        .sidebar {
            width: 200px;
            background: rgba(0, 0, 0, 0.05);
            border-right: 1px solid rgba(0, 0, 0, 0.1);
            padding: 10px;
        }

        .main-view {
            flex: 1;
            padding: 10px;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .file-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .file-icon {
            margin-right: 8px;
            font-size: 16px;
        }

        .start-menu {
            position: fixed;
            bottom: 60px;
            left: 10px;
            width: 300px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 20px;
            display: none;
            color: white;
        }

        .start-menu.active {
            display: block;
        }

        .start-menu-item {
            padding: 10px;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .start-menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .terminal {
            background: #1e1e1e;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 10px;
            height: 100%;
            overflow-y: auto;
        }

        .terminal-input {
            background: transparent;
            border: none;
            color: #00ff00;
            font-family: inherit;
            outline: none;
            width: 100%;
        }

        .user-info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .owner-credit {
            position: fixed;
            bottom: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.3);
            color: rgba(255, 255, 255, 0.8);
            padding: 8px 12px;
            border-radius: 6px;
            backdrop-filter: blur(15px);
            font-size: 12px;
            font-weight: 500;
            z-index: 500;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 20px;
        }

        .app-item {
            text-align: center;
            cursor: pointer;
            padding: 15px;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .app-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }

        .app-item .app-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
    </style>
</head>
<body>
    <div class="desktop">
        <!-- User Info -->
        <div class="user-info">
            <span id="userDisplay">Welcome, User!</span>
            <button onclick="logout()" style="margin-left: 10px; padding: 5px 10px; background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 4px; cursor: pointer;">Logout</button>
        </div>

        <!-- Owner Credit -->
        <div class="owner-credit">
            Operating system belongs to Shashank Shekhar
        </div>

        <!-- Desktop Icons -->
        <div class="desktop-icons">
            <div class="desktop-icon" onclick="openApp('chrome')">
                <div class="icon">üåê</div>
                <div class="label">Chrome</div>
            </div>
            <div class="desktop-icon" onclick="openApp('calculator')">
                <div class="icon">üî¢</div>
                <div class="label">Calculator</div>
            </div>
            <div class="desktop-icon" onclick="openApp('camera')">
                <div class="icon">üì∑</div>
                <div class="label">Camera</div>
            </div>
            <div class="desktop-icon" onclick="openApp('games')">
                <div class="icon">üéÆ</div>
                <div class="label">Games</div>
            </div>
            <div class="desktop-icon" onclick="openApp('file-manager')">
                <div class="icon">üìÅ</div>
                <div class="label">Files</div>
            </div>
            <div class="desktop-icon" onclick="openApp('terminal')">
                <div class="icon">üíª</div>
                <div class="label">Terminal</div>
            </div>
            <div class="desktop-icon" onclick="openApp('screen-share')">
                <div class="icon">üì±</div>
                <div class="label">Screen Share</div>
            </div>
            <div class="desktop-icon" onclick="openApp('settings')">
                <div class="icon">‚öôÔ∏è</div>
                <div class="label">Settings</div>
            </div>
        </div>

        <!-- File Manager Window -->
        <div id="file-manager-window" class="window" style="top: 100px; left: 200px; width: 800px; height: 600px;">
            <div class="window-header">
                <div class="window-title">üìÅ File Manager</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('file-manager')"></div>
                </div>
            </div>
            <div class="window-content">
                <div class="file-explorer">
                    <div class="sidebar">
                        <div class="file-item">
                            <span class="file-icon">üè†</span>
                            <span>Home</span>
                        </div>
                        <div class="file-item">
                            <span class="file-icon">üìÑ</span>
                            <span>Documents</span>
                        </div>
                        <div class="file-item">
                            <span class="file-icon">üì∑</span>
                            <span>Pictures</span>
                        </div>
                        <div class="file-item">
                            <span class="file-icon">üéµ</span>
                            <span>Music</span>
                        </div>
                        <div class="file-item">
                            <span class="file-icon">üì∫</span>
                            <span>Videos</span>
                        </div>
                    </div>
                    <div class="main-view" id="file-view">
                        <div style="text-align: center; padding: 50px; color: #666;">
                            <h3>Loading files...</h3>
                            <p>Your file system will appear here</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Terminal Window -->
        <div id="terminal-window" class="window" style="top: 150px; left: 250px; width: 700px; height: 500px;">
            <div class="window-header">
                <div class="window-title">üíª Terminal</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('terminal')"></div>
                </div>
            </div>
            <div class="window-content">
                <div class="terminal" id="terminal">
                    <div>My_OS Terminal v1.0</div>
                    <div>Type 'help' for available commands</div>
                    <div><span style="color: #00ff00;">user@my-os:~$ </span><input type="text" class="terminal-input" id="terminal-input" onkeypress="handleTerminalInput(event)"></div>
                </div>
            </div>
        </div>

        <!-- Apps Window -->
        <div id="apps-window" class="window" style="top: 80px; left: 300px; width: 600px; height: 500px;">
            <div class="window-header">
                <div class="window-title">üöÄ Applications</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('apps')"></div>
                </div>
            </div>
            <div class="window-content">
                <div class="app-grid">
                    <div class="app-item" onclick="openApp('calculator')">
                        <div class="app-icon">üî¢</div>
                        <div>Calculator</div>
                    </div>
                    <div class="app-item" onclick="openApp('notepad')">
                        <div class="app-icon">üìù</div>
                        <div>Notepad</div>
                    </div>
                    <div class="app-item" onclick="openApp('browser')">
                        <div class="app-icon">üåê</div>
                        <div>Browser</div>
                    </div>
                    <div class="app-item" onclick="openApp('paint')">
                        <div class="app-icon">üé®</div>
                        <div>Paint</div>
                    </div>
                    <div class="app-item" onclick="openApp('music')">
                        <div class="app-icon">üéµ</div>
                        <div>Music</div>
                    </div>
                    <div class="app-item" onclick="openApp('photos')">
                        <div class="app-icon">üì∑</div>
                        <div>Photos</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chrome Browser Window -->
        <div id="chrome-window" class="window" style="top: 50px; left: 100px; width: 1000px; height: 700px;">
            <div class="window-header">
                <div class="window-title">üåê Chrome Browser</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('chrome')"></div>
                </div>
            </div>
            <div class="window-content" style="padding: 0;">
                <div style="padding: 10px; background: #f5f5f5; border-bottom: 1px solid #ddd; display: flex; gap: 10px; align-items: center;">
                    <button onclick="browserBack()" style="padding: 5px 10px; background: #e0e0e0; border: none; border-radius: 4px; cursor: pointer;">‚Üê Back</button>
                    <button onclick="browserForward()" style="padding: 5px 10px; background: #e0e0e0; border: none; border-radius: 4px; cursor: pointer;">Forward ‚Üí</button>
                    <button onclick="browserRefresh()" style="padding: 5px 10px; background: #e0e0e0; border: none; border-radius: 4px; cursor: pointer;">‚Üª Refresh</button>
                    <input type="text" id="browser-url" placeholder="Enter URL or search..." style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" onkeypress="handleBrowserUrl(event)">
                    <button onclick="navigateTo()" style="padding: 5px 15px; background: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer;">Go</button>
                    <button onclick="takeScreenshot()" style="padding: 5px 10px; background: #ff6b6b; color: white; border: none; border-radius: 4px; cursor: pointer;">üì∑ Screenshot</button>
                    <button onclick="launchRealChrome()" style="padding: 5px 15px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer;">üöÄ Real Chrome</button>
                </div>
                <iframe id="browser-frame" src="about:blank" style="width: 100%; height: calc(100% - 60px); border: none;"></iframe>
            </div>
        </div>

        <!-- Calculator Window -->
        <div id="calculator-window" class="window" style="top: 100px; left: 400px; width: 320px; height: 450px;">
            <div class="window-header">
                <div class="window-title">üî¢ Calculator</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('calculator')"></div>
                </div>
            </div>
            <div class="window-content" style="padding: 10px;">
                <div id="calculator-display" style="width: 100%; height: 60px; background: #000; color: #0f0; font-size: 24px; font-family: monospace; padding: 15px; border-radius: 5px; text-align: right; margin-bottom: 10px; overflow: hidden;">0</div>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                    <button onclick="clearCalculator()" style="background: #ff6b6b; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">C</button>
                    <button onclick="calculatorInput('¬±')" style="background: #ffa726; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">¬±</button>
                    <button onclick="calculatorInput('%')" style="background: #ffa726; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">%</button>
                    <button onclick="calculatorInput('/')" style="background: #ffa726; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">√∑</button>
                    
                    <button onclick="calculatorInput('7')" style="background: #666; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">7</button>
                    <button onclick="calculatorInput('8')" style="background: #666; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">8</button>
                    <button onclick="calculatorInput('9')" style="background: #666; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">9</button>
                    <button onclick="calculatorInput('*')" style="background: #ffa726; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">√ó</button>
                    
                    <button onclick="calculatorInput('4')" style="background: #666; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">4</button>
                    <button onclick="calculatorInput('5')" style="background: #666; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">5</button>
                    <button onclick="calculatorInput('6')" style="background: #666; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">6</button>
                    <button onclick="calculatorInput('-')" style="background: #ffa726; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">‚àí</button>
                    
                    <button onclick="calculatorInput('1')" style="background: #666; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">1</button>
                    <button onclick="calculatorInput('2')" style="background: #666; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">2</button>
                    <button onclick="calculatorInput('3')" style="background: #666; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">3</button>
                    <button onclick="calculatorInput('+')" style="background: #ffa726; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">+</button>
                    
                    <button onclick="calculatorInput('0')" style="background: #666; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer; grid-column: span 2;">0</button>
                    <button onclick="calculatorInput('.')" style="background: #666; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">.</button>
                    <button onclick="calculateResult()" style="background: #4caf50; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer;">=</button>
                </div>
            </div>
        </div>

        <!-- Camera Window -->
        <div id="camera-window" class="window" style="top: 80px; left: 500px; width: 600px; height: 500px;">
            <div class="window-header">
                <div class="window-title">üì∑ Camera</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('camera')"></div>
                </div>
            </div>
            <div class="window-content" style="text-align: center; padding: 20px;">
                <video id="camera-video" style="width: 100%; max-width: 500px; border-radius: 10px; background: #000;" autoplay playsinline></video>
                <canvas id="camera-canvas" style="display: none;"></canvas>
                <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                    <button onclick="startCamera()" style="padding: 10px 20px; background: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer;">Start Camera</button>
                    <button onclick="takePhoto()" style="padding: 10px 20px; background: #2196f3; color: white; border: none; border-radius: 5px; cursor: pointer;">üì∏ Take Photo</button>
                    <button onclick="stopCamera()" style="padding: 10px 20px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer;">Stop Camera</button>
                </div>
                <div id="camera-photos" style="margin-top: 20px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;"></div>
            </div>
        </div>

        <!-- Games Window -->
        <div id="games-window" class="window" style="top: 60px; left: 200px; width: 800px; height: 600px;">
            <div class="window-header">
                <div class="window-title">üéÆ Games</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('games')"></div>
                </div>
            </div>
            <div class="window-content">
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <button onclick="startSnakeGame()" style="padding: 15px 30px; background: #4caf50; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer;">üêç Snake Game</button>
                    <button onclick="startDinoGame()" style="padding: 15px 30px; background: #ff9800; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer;">ü¶ï Dino Game</button>
                </div>
                <div id="game-area" style="width: 100%; height: 500px; border: 2px solid #333; border-radius: 10px; background: #000; position: relative; overflow: hidden;">
                    <div id="game-start-screen" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: white;">
                        <h2>üéÆ Choose a Game to Play</h2>
                        <p>Select Snake or Dino game above to start playing!</p>
                    </div>
                    <canvas id="game-canvas" style="display: none; background: #000;"></canvas>
                </div>
            </div>
        </div>

        <!-- Screen Share Window -->
        <div id="screen-share-window" class="window" style="top: 70px; left: 150px; width: 900px; height: 650px;">
            <div class="window-header">
                <div class="window-title">üì± Phone Screen Share</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('screen-share')"></div>
                </div>
            </div>
            <div class="window-content" style="padding: 20px; text-align: center;">
                <div style="display: flex; gap: 30px; height: 100%;">
                    <!-- Phone Preview Area -->
                    <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                        <div id="phone-frame" style="width: 300px; height: 550px; background: #000; border: 20px solid #333; border-radius: 25px; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                            <div id="phone-screen" style="width: 100%; height: 100%; background: linear-gradient(45deg, #667eea, #764ba2); border-radius: 5px; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; position: relative; overflow: hidden;">
                                <div id="phone-content">
                                    <div style="text-align: center;">
                                        <div style="font-size: 48px; margin-bottom: 20px;">üì±</div>
                                        <div>Connect your phone to start screen sharing</div>
                                        <div style="margin-top: 20px; font-size: 14px; opacity: 0.8;">Choose a method below</div>
                                    </div>
                                </div>
                                <video id="screenshare-video" style="width: 100%; height: 100%; object-fit: cover; display: none;" autoplay playsinline></video>
                                <canvas id="screenshare-canvas" style="width: 100%; height: 100%; object-fit: cover; display: none;"></canvas>
                            </div>
                        </div>
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button onclick="toggleScreenRecord()" id="record-btn" style="padding: 10px 20px; background: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer;">üî¥ Start Recording</button>
                            <button onclick="takeScreenshotPhone()" style="padding: 10px 20px; background: #2196f3; color: white; border: none; border-radius: 5px; cursor: pointer;">üì∑ Screenshot</button>
                            <button onclick="fullscreenPhone()" style="padding: 10px 20px; background: #ff9800; color: white; border: none; border-radius: 5px; cursor: pointer;">üîç Fullscreen</button>
                        </div>
                    </div>
                    
                    <!-- Control Panel -->
                    <div style="flex: 1; text-align: left;">
                        <h3 style="margin-bottom: 20px; color: #333;">Connection Methods</h3>
                        
                        <!-- Screen Capture API -->
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                            <h4 style="color: #495057; margin-bottom: 15px;">üíª Desktop Screen Capture</h4>
                            <p style="color: #6c757d; margin-bottom: 15px; font-size: 14px;">Share your entire desktop or specific window</p>
                            <button onclick="startDesktopCapture()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">Start Desktop Sharing</button>
                        </div>
                        
                        <!-- QR Code Connection -->
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                            <h4 style="color: #495057; margin-bottom: 15px;">üì± Mobile Connection</h4>
                            <p style="color: #6c757d; margin-bottom: 15px; font-size: 14px;">Scan QR code with your phone</p>
                            <div id="qr-code" style="background: white; padding: 20px; text-align: center; border-radius: 8px; margin-bottom: 15px;">
                                <div style="font-size: 48px; color: #333;">‚ñ°‚ñ†‚ñ°</div>
                                <div style="margin-top: 10px; font-size: 12px; color: #666;">QR Code</div>
                                <div style="margin-top: 5px; font-size: 11px; color: #999;">http://localhost:2999/mobile-share</div>
                            </div>
                            <button onclick="generateQRCode()" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">Generate QR Code</button>
                        </div>
                        
                        <!-- WebRTC Connection -->
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                            <h4 style="color: #495057; margin-bottom: 15px;">üåê Direct WebRTC</h4>
                            <p style="color: #6c757d; margin-bottom: 15px; font-size: 14px;">Direct peer-to-peer connection</p>
                            <input type="text" id="connection-id" placeholder="Enter connection ID" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; margin-bottom: 10px;">
                            <div style="display: flex; gap: 5px;">
                                <button onclick="createConnection()" style="padding: 8px 15px; background: #6f42c1; color: white; border: none; border-radius: 4px; cursor: pointer; flex: 1; font-size: 12px;">Create Room</button>
                                <button onclick="joinConnection()" style="padding: 8px 15px; background: #fd7e14; color: white; border: none; border-radius: 4px; cursor: pointer; flex: 1; font-size: 12px;">Join Room</button>
                            </div>
                        </div>
                        
                        <!-- Connection Status -->
                        <div style="background: #e9ecef; padding: 15px; border-radius: 8px;">
                            <h5 style="color: #495057; margin-bottom: 10px;">Connection Status</h5>
                            <div id="connection-status" style="color: #6c757d; font-size: 14px;">Not connected</div>
                            <div id="connection-info" style="color: #868e96; font-size: 12px; margin-top: 5px;"></div>
                        </div>
                        
                        <!-- Screenshot Gallery -->
                        <div style="margin-top: 20px;">
                            <h5 style="color: #495057; margin-bottom: 10px;">Screenshots</h5>
                            <div id="screenshot-gallery" style="display: flex; flex-wrap: wrap; gap: 5px; max-height: 100px; overflow-y: auto;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Window -->
        <div id="settings-window" class="window" style="top: 120px; left: 350px; width: 500px; height: 400px;">
            <div class="window-header">
                <div class="window-title">‚öôÔ∏è Settings</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('settings')"></div>
                </div>
            </div>
            <div class="window-content">
                <h3>System Settings</h3>
                <div style="margin-top: 20px;">
                    <h4>Display</h4>
                    <label>
                        <input type="range" min="0.5" max="2" step="0.1" value="1" onchange="changeScale(this.value)">
                        UI Scale: <span id="scale-value">1.0x</span>
                    </label>
                </div>
                <div style="margin-top: 20px;">
                    <h4>Theme</h4>
                    <select onchange="changeTheme(this.value)">
                        <option value="default">Default</option>
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                    </select>
                </div>
                <div style="margin-top: 20px;">
                    <h4>About</h4>
                    <p>My_OS v1.0 - Web Desktop Environment</p>
                    <p>Built with HTML, CSS, and JavaScript</p>
                </div>
            </div>
        </div>

        <!-- Notepad Window -->
        <div id="notepad-window" class="window" style="top: 90px; left: 300px; width: 700px; height: 500px;">
            <div class="window-header">
                <div class="window-title">üìù Notepad</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('notepad')"></div>
                </div>
            </div>
            <div class="window-content" style="padding: 0;">
                <div style="padding: 10px; background: #f5f5f5; border-bottom: 1px solid #ddd; display: flex; gap: 10px;">
                    <button onclick="newDocument()" style="padding: 5px 10px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer;">üìÑ New</button>
                    <button onclick="saveDocument()" style="padding: 5px 10px; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer;">üíæ Save</button>
                    <button onclick="loadDocument()" style="padding: 5px 10px; background: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer;">üìÇ Open</button>
                    <span style="margin-left: auto; color: #666; font-size: 12px;">Characters: <span id="char-count">0</span></span>
                </div>
                <textarea id="notepad-text" placeholder="Start typing your notes..." style="width: 100%; height: calc(100% - 50px); border: none; padding: 20px; font-family: 'Courier New', monospace; font-size: 14px; resize: none; outline: none;"></textarea>
            </div>
        </div>

        <!-- Browser Window (for apps menu) -->
        <div id="browser-window" class="window" style="top: 60px; left: 200px; width: 900px; height: 600px;">
            <div class="window-header">
                <div class="window-title">üåê Web Browser</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('browser')"></div>
                </div>
            </div>
            <div class="window-content" style="padding: 0;">
                <div style="padding: 10px; background: #f5f5f5; border-bottom: 1px solid #ddd; display: flex; gap: 10px; align-items: center;">
                    <button onclick="browserBack2()" style="padding: 5px 10px; background: #e0e0e0; border: none; border-radius: 4px; cursor: pointer;">‚Üê Back</button>
                    <button onclick="browserForward2()" style="padding: 5px 10px; background: #e0e0e0; border: none; border-radius: 4px; cursor: pointer;">Forward ‚Üí</button>
                    <button onclick="browserRefresh2()" style="padding: 5px 10px; background: #e0e0e0; border: none; border-radius: 4px; cursor: pointer;">‚Üª Refresh</button>
                    <input type="text" id="browser-url2" placeholder="Enter URL or search..." style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" onkeypress="handleBrowserUrl2(event)" value="https://www.google.com">
                    <button onclick="navigateTo2()" style="padding: 5px 15px; background: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer;">Go</button>
                </div>
                <iframe id="browser-frame2" src="https://www.example.com" style="width: 100%; height: calc(100% - 60px); border: none;"></iframe>
            </div>
        </div>

        <!-- Paint Window -->
        <div id="paint-window" class="window" style="top: 80px; left: 400px; width: 800px; height: 600px;">
            <div class="window-header">
                <div class="window-title">üé® Paint</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('paint')"></div>
                </div>
            </div>
            <div class="window-content" style="padding: 0;">
                <div style="padding: 10px; background: #f5f5f5; border-bottom: 1px solid #ddd; display: flex; gap: 10px; align-items: center;">
                    <button onclick="clearCanvas()" style="padding: 5px 10px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">üóëÔ∏è Clear</button>
                    <label>üñåÔ∏è Brush Size: <input type="range" id="brush-size" min="1" max="50" value="5" style="margin-left: 5px;"></label>
                    <label>üé® Color: <input type="color" id="brush-color" value="#000000" style="margin-left: 5px;"></label>
                    <button onclick="savePainting()" style="padding: 5px 10px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer;">üíæ Save</button>
                </div>
                <canvas id="paint-canvas" style="background: white; cursor: crosshair; display: block;"></canvas>
            </div>
        </div>

        <!-- Music Player Window -->
        <div id="music-window" class="window" style="top: 100px; left: 250px; width: 600px; height: 400px;">
            <div class="window-header">
                <div class="window-title">üéµ Music Player</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('music')"></div>
                </div>
            </div>
            <div class="window-content" style="text-align: center;">
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 48px; margin-bottom: 10px;">üéµ</div>
                    <h3 id="current-song">No song selected</h3>
                    <p id="artist-name" style="color: #666;">Select a song to play</p>
                </div>
                <div style="margin: 20px 0;">
                    <button onclick="previousSong()" style="padding: 10px; background: #666; color: white; border: none; border-radius: 50%; cursor: pointer; margin: 0 10px;">‚èÆÔ∏è</button>
                    <button onclick="togglePlayPause()" id="play-pause-btn" style="padding: 15px; background: #4caf50; color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 18px; margin: 0 10px;">‚ñ∂Ô∏è</button>
                    <button onclick="nextSong()" style="padding: 10px; background: #666; color: white; border: none; border-radius: 50%; cursor: pointer; margin: 0 10px;">‚è≠Ô∏è</button>
                </div>
                <div style="margin: 20px 0;">
                    <input type="range" id="music-progress" min="0" max="100" value="0" style="width: 80%;" disabled>
                </div>
                <div style="margin-top: 20px;">
                    <h4>Playlist</h4>
                    <div id="playlist" style="text-align: left; max-height: 150px; overflow-y: auto; background: #f5f5f5; padding: 10px; border-radius: 5px;">
                        <div class="song-item" onclick="selectSong('Chill Vibes', 'Lo-Fi Beats')" style="padding: 8px; cursor: pointer; border-radius: 4px;">üé∂ Chill Vibes - Lo-Fi Beats</div>
                        <div class="song-item" onclick="selectSong('Electronic Dreams', 'Synth Wave')" style="padding: 8px; cursor: pointer; border-radius: 4px;">üéπ Electronic Dreams - Synth Wave</div>
                        <div class="song-item" onclick="selectSong('Nature Sounds', 'Ambient')" style="padding: 8px; cursor: pointer; border-radius: 4px;">üåø Nature Sounds - Ambient</div>
                        <div class="song-item" onclick="selectSong('Retro Gaming', 'Chiptune')" style="padding: 8px; cursor: pointer; border-radius: 4px;">üéÆ Retro Gaming - Chiptune</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Photos Gallery Window -->
        <div id="photos-window" class="window" style="top: 90px; left: 180px; width: 700px; height: 500px;">
            <div class="window-header">
                <div class="window-title">üì∑ Photos</div>
                <div class="window-controls">
                    <div class="window-control minimize"></div>
                    <div class="window-control maximize"></div>
                    <div class="window-control close" onclick="closeApp('photos')"></div>
                </div>
            </div>
            <div class="window-content">
                <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center;">
                    <button onclick="uploadPhoto()" style="padding: 8px 15px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer;">üìÅ Upload Photo</button>
                    <input type="file" id="photo-upload" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                    <button onclick="takePhotoFromCamera()" style="padding: 8px 15px; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer;">üì∏ Take Photo</button>
                    <select id="view-mode" onchange="changePhotoView(this.value)" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="grid">Grid View</option>
                        <option value="list">List View</option>
                    </select>
                </div>
                <div id="photos-gallery" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; max-height: 350px; overflow-y: auto; padding: 10px; background: #f9f9f9; border-radius: 8px;">
                    <div class="photo-placeholder" style="aspect-ratio: 1; background: linear-gradient(45deg, #e0e0e0, #f5f5f5); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #999; font-size: 24px; cursor: pointer;" onclick="uploadPhoto()">üì∑<br><small>Add Photos</small></div>
                    <!-- Sample photos -->
                    <div class="photo-item" style="aspect-ratio: 1; background: linear-gradient(45deg, #ff9800, #ffc107); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 36px; cursor: pointer;" onclick="viewPhoto('Sample Image 1')">üåÖ</div>
                    <div class="photo-item" style="aspect-ratio: 1; background: linear-gradient(45deg, #4caf50, #8bc34a); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 36px; cursor: pointer;" onclick="viewPhoto('Sample Image 2')">üå≤</div>
                    <div class="photo-item" style="aspect-ratio: 1; background: linear-gradient(45deg, #2196f3, #03a9f4); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 36px; cursor: pointer;" onclick="viewPhoto('Sample Image 3')">üåä</div>
                </div>
            </div>
        </div>

        <!-- Taskbar -->
        <div class="taskbar">
            <button class="start-button" onclick="toggleStartMenu()">üè† Start</button>
            <div class="taskbar-apps" id="taskbar-apps">
            </div>
            <div class="system-tray">
                <div class="system-tray-item" id="hotspot-icon" title="Hotspot" onclick="toggleSystemPanel()">
                    üì∂
                </div>
                <div class="system-tray-item" id="battery-icon" title="Battery" onclick="toggleSystemPanel()">
                    üîã
                </div>
                <div class="system-tray-item" id="sound-icon" title="Sound" onclick="toggleSystemPanel()">
                    üîä
                </div>
                <div class="system-tray-item" id="temperature-icon" title="Temperature" onclick="toggleSystemPanel()">
                    üå°Ô∏è
                </div>
            </div>
            <div class="taskbar-time" id="taskbar-time"></div>
        </div>

        <!-- System Status Panel -->
        <div id="system-panel" class="system-panel">
            <div class="system-panel-section">
                <div class="system-panel-title">üì∂ WiFi Networks</div>
                <div style="margin-bottom: 10px;">
                    <button onclick="scanWifiNetworks()" style="padding: 6px 12px; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">üîç Scan Networks</button>
                    <span id="wifi-status" style="margin-left: 10px; font-size: 12px; opacity: 0.8;">Click to scan</span>
                </div>
                <div id="wifi-networks" style="max-height: 120px; overflow-y: auto; background: rgba(255,255,255,0.1); border-radius: 6px; padding: 8px;">
                    <div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 12px; padding: 10px;">No networks scanned yet</div>
                </div>
                <div class="system-control" style="margin-top: 10px;">
                    <span>Mobile Hotspot</span>
                    <div class="system-toggle" id="hotspot-toggle" onclick="toggleHotspot()"></div>
                </div>
                <div class="status-indicator" id="hotspot-status">Hotspot: Off ‚Ä¢ No devices connected</div>
            </div>

            <div class="system-panel-section">
                <div class="system-panel-title">üîã Battery Status</div>
                <div class="battery-indicator">
                    <div class="battery-bar">
                        <div class="battery-fill" id="battery-fill" style="width: 85%;"></div>
                    </div>
                    <span id="battery-percentage">85%</span>
                </div>
                <div class="status-indicator" id="battery-status">Good ‚Ä¢ 3h 24m remaining</div>
            </div>

            <div class="system-panel-section">
                <div class="system-panel-title">üîä Sound Controls</div>
                <div class="system-control">
                    <span>Master Volume</span>
                    <span id="volume-percentage">75%</span>
                </div>
                <input type="range" class="system-slider" id="volume-slider" min="0" max="100" value="75" oninput="updateVolume(this.value)">
                <div class="system-control">
                    <span>Microphone</span>
                    <div class="system-toggle active" id="microphone-toggle" onclick="toggleMicrophone()"></div>
                </div>
            </div>

            <div class="system-panel-section">
                <div class="system-panel-title">üå°Ô∏è System Temperature</div>
                <div class="temperature-indicator">
                    <div class="temp-gauge">
                        <div class="temp-level" id="temp-level" style="height: 35%;"></div>
                    </div>
                    <div><strong id="cpu-temp">42¬∞C</strong></div>
                    <div class="status-indicator">CPU Normal</div>
                </div>
            </div>
        </div>

        <!-- Start Menu -->
        <div id="start-menu" class="start-menu">
            <div class="start-menu-item" onclick="openApp('chrome')">
                <span>üåê</span>
                <span>Chrome Browser</span>
            </div>
            <div class="start-menu-item" onclick="openApp('calculator')">
                <span>üî¢</span>
                <span>Calculator</span>
            </div>
            <div class="start-menu-item" onclick="openApp('camera')">
                <span>üì∑</span>
                <span>Camera</span>
            </div>
            <div class="start-menu-item" onclick="openApp('games')">
                <span>üéÆ</span>
                <span>Games</span>
            </div>
            <div class="start-menu-item" onclick="openApp('file-manager')">
                <span>üìÅ</span>
                <span>File Manager</span>
            </div>
            <div class="start-menu-item" onclick="openApp('terminal')">
                <span>üíª</span>
                <span>Terminal</span>
            </div>
            <div class="start-menu-item" onclick="openApp('settings')">
                <span>‚öôÔ∏è</span>
                <span>Settings</span>
            </div>
            <hr style="margin: 10px 0; border: 1px solid rgba(255,255,255,0.2);">
            <div class="start-menu-item" onclick="logout()">
                <span>üö¶</span>
                <span>Logout</span>
            </div>
        </div>
    </div>

    <script>
        let openApps = new Set();
        let ws = null;

        // Initialize desktop
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/';
                return;
            }

            // Load user profile
            loadUserProfile();
            
            // Update time
            updateTime();
            setInterval(updateTime, 1000);
            
            // Load file system
            loadFiles();

            // Setup WebSocket
            setupWebSocket();

            // Make windows draggable
            makeWindowsDraggable();
        });

        function loadUserProfile() {
            const token = localStorage.getItem('token');
            fetch('/profile', {
                headers: { 'Authorization': 'Bearer ' + token }
            })
            .then(response => response.json())
            .then(data => {
                if (data.username) {
                    document.getElementById('userDisplay').textContent = 'Welcome, ' + data.username + '!';
                }
            })
            .catch(error => {
                console.error('Error loading profile:', error);
            });
        }

        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const dateString = now.toLocaleDateString([], {month: 'short', day: 'numeric'});
            document.getElementById('taskbar-time').innerHTML = `${timeString}<br><small>${dateString}</small>`;
        }

        function toggleStartMenu() {
            const startMenu = document.getElementById('start-menu');
            startMenu.classList.toggle('active');
        }

        function openApp(appName) {
            const window = document.getElementById(appName + '-window');
            if (window) {
                window.classList.add('active');
                openApps.add(appName);
                updateTaskbar();
                
                // Close start menu
                document.getElementById('start-menu').classList.remove('active');
                
                // Bring to front
                bringToFront(window);
            }
        }

        function closeApp(appName) {
            const window = document.getElementById(appName + '-window');
            if (window) {
                window.classList.remove('active');
                openApps.delete(appName);
                updateTaskbar();
            }
        }

        function updateTaskbar() {
            const taskbarApps = document.getElementById('taskbar-apps');
            taskbarApps.innerHTML = '';
            
            openApps.forEach(appName => {
                const appButton = document.createElement('button');
                appButton.style.cssText = `
                    background: rgba(255, 255, 255, 0.2);
                    border: none;
                    color: white;
                    padding: 8px 15px;
                    border-radius: 6px;
                    cursor: pointer;
                    margin-right: 5px;
                `;
                appButton.textContent = appName.charAt(0).toUpperCase() + appName.slice(1).replace('-', ' ');
                appButton.onclick = () => openApp(appName);
                taskbarApps.appendChild(appButton);
            });
        }

        function bringToFront(window) {
            const allWindows = document.querySelectorAll('.window');
            let maxZ = 100;
            allWindows.forEach(w => {
                const z = parseInt(getComputedStyle(w).zIndex) || 100;
                if (z > maxZ) maxZ = z;
            });
            window.style.zIndex = maxZ + 1;
        }

        function makeWindowsDraggable() {
            document.querySelectorAll('.window').forEach(window => {
                const header = window.querySelector('.window-header');
                let isDragging = false;
                let startX, startY, initialX, initialY;

                header.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    initialX = window.offsetLeft;
                    initialY = window.offsetTop;
                    bringToFront(window);
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;
                    window.style.left = (initialX + deltaX) + 'px';
                    window.style.top = (initialY + deltaY) + 'px';
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
            });
        }

        function loadFiles() {
            fetch('/api/files')
            .then(response => response.json())
            .then(files => {
                displayFiles(files);
            })
            .catch(error => {
                document.getElementById('file-view').innerHTML = 
                    '<div style="text-align: center; padding: 50px; color: #666;"><h3>Error loading files</h3><p>' + error.message + '</p></div>';
            });
        }

        function displayFiles(files) {
            const fileView = document.getElementById('file-view');
            fileView.innerHTML = '';
            
            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span class="file-icon">${file.type === 'folder' ? 'üìÅ' : 'üìÑ'}</span>
                    <span>${file.name}</span>
                `;
                fileView.appendChild(fileItem);
            });
        }

        function setupWebSocket() {
            ws = new WebSocket('ws://localhost:2999');
            
            ws.onopen = function(event) {
                console.log('WebSocket connected');
            };
            
            ws.onmessage = function(event) {
                console.log('Received:', event.data);
            };
            
            ws.onclose = function(event) {
                console.log('WebSocket disconnected');
                // Attempt to reconnect after 5 seconds
                setTimeout(setupWebSocket, 5000);
            };
        }

        function handleTerminalInput(event) {
            if (event.key === 'Enter') {
                const input = event.target;
                const command = input.value;
                const terminal = document.getElementById('terminal');
                
                // Add command to terminal
                const commandLine = document.createElement('div');
                commandLine.innerHTML = `<span style="color: #00ff00;">user@my-os:~$ </span>${command}`;
                terminal.insertBefore(commandLine, terminal.lastElementChild);
                
                // Process command
                processCommand(command);
                
                // Clear input
                input.value = '';
            }
        }

        // Terminal state
        let currentDirectory = '/home/user';
        
        // Mock file system structure
        const fileSystem = {
            '/': {
                type: 'directory',
                contents: {
                    'home': {
                        type: 'directory',
                        contents: {
                            'user': {
                                type: 'directory',
                                contents: {
                                    'Documents': { type: 'directory', contents: {} },
                                    'Pictures': { type: 'directory', contents: {} },
                                    'Downloads': { type: 'directory', contents: {} },
                                    'Desktop': { type: 'directory', contents: {} },
                                    'readme.txt': { type: 'file', size: 1024 },
                                    'notes.txt': { type: 'file', size: 512 }
                                }
                            }
                        }
                    },
                    'usr': {
                        type: 'directory',
                        contents: {
                            'bin': { type: 'directory', contents: {} },
                            'lib': { type: 'directory', contents: {} }
                        }
                    },
                    'etc': { type: 'directory', contents: {} },
                    'var': { type: 'directory', contents: {} }
                }
            }
        };
        
        function resolvePath(path) {
            if (path.startsWith('/')) {
                // Absolute path
                return path;
            } else if (path === '.') {
                return currentDirectory;
            } else if (path === '..') {
                const parts = currentDirectory.split('/').filter(p => p);
                parts.pop();
                return '/' + parts.join('/');
            } else if (path.startsWith('./')) {
                return currentDirectory + '/' + path.substring(2);
            } else if (path.startsWith('../')) {
                const parts = currentDirectory.split('/').filter(p => p);
                let pathParts = path.split('/').filter(p => p);
                
                for (const part of pathParts) {
                    if (part === '..') {
                        parts.pop();
                    } else {
                        parts.push(part);
                    }
                }
                
                return '/' + parts.join('/');
            } else {
                // Relative path
                return currentDirectory + '/' + path;
            }
        }
        
        function pathExists(path) {
            const cleanPath = path.replace(/\/+/g, '/').replace(/\/$/, '') || '/';
            const parts = cleanPath === '/' ? [] : cleanPath.substring(1).split('/');
            
            let current = fileSystem['/'];
            for (const part of parts) {
                if (!current.contents || !current.contents[part]) {
                    return false;
                }
                current = current.contents[part];
            }
            return true;
        }
        
        function isDirectory(path) {
            const cleanPath = path.replace(/\/+/g, '/').replace(/\/$/, '') || '/';
            const parts = cleanPath === '/' ? [] : cleanPath.substring(1).split('/');
            
            let current = fileSystem['/'];
            for (const part of parts) {
                if (!current.contents || !current.contents[part]) {
                    return false;
                }
                current = current.contents[part];
            }
            return current.type === 'directory';
        }
        
        function getCurrentDirectoryContents() {
            const cleanPath = currentDirectory.replace(/\/+/g, '/').replace(/\/$/, '') || '/';
            const parts = cleanPath === '/' ? [] : cleanPath.substring(1).split('/');
            
            let current = fileSystem['/'];
            for (const part of parts) {
                if (!current.contents || !current.contents[part]) {
                    return {};
                }
                current = current.contents[part];
            }
            return current.contents || {};
        }
        
        function getPrompt() {
            const shortPath = currentDirectory.replace('/home/user', '~');
            return `user@my-os:${shortPath}$ `;
        }
        
        function updateTerminalPrompt() {
            const terminalInput = document.getElementById('terminal-input');
            if (terminalInput && terminalInput.parentElement) {
                const promptSpan = terminalInput.parentElement.querySelector('span');
                if (promptSpan) {
                    promptSpan.textContent = getPrompt();
                }
            }
        }

        function processCommand(command) {
            const terminal = document.getElementById('terminal');
            const output = document.createElement('div');
            const args = command.trim().split(/\s+/);
            const cmd = args[0].toLowerCase();
            
            switch(cmd) {
                case 'help':
                    output.innerHTML = `Available commands:<br>
                        - help: Show this help<br>
                        - clear: Clear terminal<br>
                        - date: Show current date<br>
                        - whoami: Show current user<br>
                        - echo [text]: Echo text<br>
                        - pwd: Print working directory<br>
                        - ls: List directory contents<br>
                        - cd [path]: Change directory<br>
                        - apps: List applications`;
                    break;
                case 'clear':
                    terminal.innerHTML = `
                        <div>My_OS Terminal v1.0</div>
                        <div>Type 'help' for available commands</div>
                        <div><span style="color: #00ff00;">${getPrompt()}</span><input type="text" class="terminal-input" id="terminal-input" onkeypress="handleTerminalInput(event)"></div>
                    `;
                    return;
                case 'pwd':
                    output.textContent = currentDirectory;
                    break;
                case 'ls':
                    const contents = getCurrentDirectoryContents();
                    const items = Object.keys(contents);
                    if (items.length === 0) {
                        output.textContent = '(empty directory)';
                    } else {
                        const itemList = items.map(name => {
                            const item = contents[name];
                            const icon = item.type === 'directory' ? 'üìÅ' : 'üìÑ';
                            const color = item.type === 'directory' ? '#4caf50' : '#fff';
                            return `<span style="color: ${color};">${icon} ${name}</span>`;
                        }).join('  ');
                        output.innerHTML = itemList;
                    }
                    break;
                case 'cd':
                    if (args.length === 1) {
                        // No argument, go to home directory
                        currentDirectory = '/home/user';
                    } else {
                        const targetPath = resolvePath(args[1]);
                        const cleanPath = targetPath.replace(/\/+/g, '/').replace(/\/$/, '') || '/';
                        
                        if (!pathExists(cleanPath)) {
                            output.innerHTML = `<span style="color: #ff6b6b;">cd: ${args[1]}: No such file or directory</span>`;
                        } else if (!isDirectory(cleanPath)) {
                            output.innerHTML = `<span style="color: #ff6b6b;">cd: ${args[1]}: Not a directory</span>`;
                        } else {
                            currentDirectory = cleanPath;
                            // Update the prompt immediately
                            setTimeout(updateTerminalPrompt, 10);
                        }
                    }
                    break;
                case 'date':
                    output.textContent = new Date().toString();
                    break;
                case 'whoami':
                    const token = localStorage.getItem('token');
                    output.textContent = token ? 'user' : 'guest';
                    break;
                case 'apps':
                    output.innerHTML = 'Available apps: File Manager, Terminal, Applications, Settings';
                    break;
                default:
                    if (command.startsWith('echo ')) {
                        output.textContent = command.substring(5);
                    } else if (command.trim()) {
                        output.innerHTML = `<span style="color: #ff6b6b;">Command not found: ${command}</span>`;
                    }
            }
            
            if (output.innerHTML || output.textContent) {
                terminal.insertBefore(output, terminal.lastElementChild);
            }
            
            // Update prompt for next command
            setTimeout(updateTerminalPrompt, 10);
            
            // Scroll to bottom
            terminal.scrollTop = terminal.scrollHeight;
        }

        function changeScale(value) {
            document.body.style.transform = `scale(${value})`;
            document.body.style.transformOrigin = 'top left';
            document.getElementById('scale-value').textContent = value + 'x';
        }

        function changeTheme(theme) {
            // Theme changing functionality would go here
            console.log('Changing theme to:', theme);
        }

        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/';
        }

        // Close start menu when clicking outside
        document.addEventListener('click', function(event) {
            const startMenu = document.getElementById('start-menu');
            const startButton = document.querySelector('.start-button');
            
            if (!startMenu.contains(event.target) && !startButton.contains(event.target)) {
                startMenu.classList.remove('active');
            }
        });

        // Handle window clicks to bring to front
        document.querySelectorAll('.window').forEach(window => {
            window.addEventListener('mousedown', () => {
                bringToFront(window);
            });
        });

        // ========== BROWSER FUNCTIONS ==========
        function handleBrowserUrl(event) {
            if (event.key === 'Enter') {
                navigateTo();
            }
        }

        function navigateTo() {
            const url = document.getElementById('browser-url').value;
            const frame = document.getElementById('browser-frame');
            
            if (url) {
                let targetUrl = url;
                let isSearch = false;
                
                // Handle different URL types
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    if (url.includes('.') && !url.includes(' ')) {
                        // Looks like a domain
                        targetUrl = 'https://' + url;
                    } else {
                        // Search query - use DuckDuckGo which allows iframes
                        targetUrl = 'https://duckduckgo.com/?q=' + encodeURIComponent(url);
                        isSearch = true;
                    }
                }
                
                // For Google searches or blocked sites, show immediate fallback
                if (targetUrl.includes('google.com') || isSearch) {
                    showSearchFallback(url, targetUrl);
                    return;
                }
                
                // Try to load the URL
                try {
                    frame.src = targetUrl;
                    console.log('Navigating to:', targetUrl);
                    
                    // Set a timeout to detect if the iframe fails to load
                    setTimeout(() => {
                        try {
                            // Try to access iframe content to detect if it loaded
                            const iframeDoc = frame.contentDocument || frame.contentWindow.document;
                            if (!iframeDoc || iframeDoc.body.innerHTML.trim() === '') {
                                showLoadError(targetUrl);
                            }
                        } catch (e) {
                            // Cross-origin error means the site loaded but blocks access
                            // This is actually good - the site is working
                            console.log('Site loaded successfully (cross-origin)');
                        }
                    }, 3000);
                    
                } catch (error) {
                    console.error('Navigation failed:', error);
                    showLoadError(targetUrl);
                }
            }
        }
        
        function showSearchFallback(query, fullUrl) {
            const frame = document.getElementById('browser-frame');
            const searchResults = `
                <html>
                <head>
                    <title>Search Results - ${query}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f8f9fa; }
                        .search-container { max-width: 800px; margin: 0 auto; }
                        .search-header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
                        .search-results { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
                        .result-item { padding: 15px 0; border-bottom: 1px solid #eee; }
                        .result-title { color: #1a0dab; font-size: 18px; font-weight: normal; margin-bottom: 5px; }
                        .result-url { color: #006621; font-size: 14px; margin-bottom: 5px; }
                        .result-desc { color: #545454; font-size: 14px; line-height: 1.4; }
                        .open-btn { background: #4285f4; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
                        .open-btn:hover { background: #3367d6; }
                        .search-info { background: #e8f0fe; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <div class="search-container">
                        <div class="search-header">
                            <h1>üîç Search Results for: "${query}"</h1>
                            <div class="search-info">
                                <p><strong>Why am I seeing this?</strong> Google blocks iframe embedding for security. Here are your options:</p>
                            </div>
                            <button class="open-btn" onclick="window.open('${fullUrl}', '_blank')">üîç Open Google Search in New Tab</button>
                            <button class="open-btn" onclick="window.open('https://duckduckgo.com/?q=${encodeURIComponent(query)}', '_blank')">ü¶Ü Try DuckDuckGo Search</button>
                            <button class="open-btn" onclick="window.open('https://www.bing.com/search?q=${encodeURIComponent(query)}', '_blank')">‚ìÇÔ∏è Try Bing Search</button>
                        </div>
                        
                        <div class="search-results">
                            <h2>Sample Search Information:</h2>
                            ${generateSampleResults(query)}
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            frame.srcdoc = searchResults;
        }
        
        function generateSampleResults(query) {
            // Generate relevant sample results based on the query
            if (query.toLowerCase().includes('chris gayle')) {
                return `
                    <div class="result-item">
                        <div class="result-title">Chris Gayle - West Indies Cricket</div>
                        <div class="result-url">https://en.wikipedia.org/wiki/Chris_Gayle</div>
                        <div class="result-desc">Christopher Henry Gayle is a Jamaican cricketer who plays international cricket for the West Indies. He is widely regarded as one of the greatest batsmen in limited-overs cricket.</div>
                    </div>
                    <div class="result-item">
                        <div class="result-title">Chris Gayle Stats & Records</div>
                        <div class="result-url">https://www.espncricinfo.com/player/chris-gayle-51880</div>
                        <div class="result-desc">Complete cricket statistics and records for Chris Gayle including Test, ODI, and T20 career highlights and achievements.</div>
                    </div>
                    <div class="result-item">
                        <div class="result-title">Chris Gayle Latest News</div>
                        <div class="result-url">https://www.cricbuzz.com/profiles/476/chris-gayle</div>
                        <div class="result-desc">Latest news, updates, and match performances by Chris Gayle. Known as the "Universe Boss" for his explosive batting style.</div>
                    </div>
                `;
            } else {
                return `
                    <div class="result-item">
                        <div class="result-title">Search Results for "${query}"</div>
                        <div class="result-url">Results would appear here</div>
                        <div class="result-desc">Use the buttons above to open your search in Google, DuckDuckGo, or Bing in a new tab with full functionality.</div>
                    </div>
                `;
            }
        }
        
        function showLoadError(targetUrl) {
            const frame = document.getElementById('browser-frame');
            const errorPage = `
                <html>
                <head><title>Navigation Error</title></head>
                <body style="font-family: Arial, sans-serif; padding: 40px; text-align: center; background: #f8f9fa;">
                    <div style="max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <h2 style="color: #d73527;">üö´ Unable to load ${targetUrl}</h2>
                        <p style="color: #666; margin-bottom: 20px;">This site cannot be displayed in an iframe due to security restrictions.</p>
                        <div style="background: #e8f0fe; padding: 15px; border-radius: 6px; margin: 20px 0;">
                            <p><strong>Solutions:</strong></p>
                            <ul style="text-align: left; display: inline-block; margin: 10px 0;">
                                <li>Click below to open in a new tab with full functionality</li>
                                <li>Use the "üöÄ Real Chrome" button for unrestricted browsing</li>
                                <li>Try iframe-friendly alternatives</li>
                            </ul>
                        </div>
                        <button onclick="window.open('${targetUrl}', '_blank')" style="padding: 12px 24px; background: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin: 10px;">üì± Open in New Tab</button>
                        <button onclick="parent.launchRealChrome()" style="padding: 12px 24px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin: 10px;">üöÄ Launch Real Chrome</button>
                    </div>
                </body>
                </html>
            `;
            
            frame.srcdoc = errorPage;
        }

        function browserBack() {
            const frame = document.getElementById('browser-frame');
            frame.contentWindow.history.back();
        }

        function browserForward() {
            const frame = document.getElementById('browser-frame');
            frame.contentWindow.history.forward();
        }

        function browserRefresh() {
            const frame = document.getElementById('browser-frame');
            frame.src = frame.src;
        }

        // Launch real Chrome with permissions
        function launchRealChrome() {
            const currentUrl = document.getElementById('browser-url').value || 'https://www.google.com';
            
            // Try to communicate with the server to launch Chrome
            fetch('/launch-chrome', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: currentUrl })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('üöÄ Chrome launched with full permissions!');
                } else {
                    throw new Error(data.message || 'Launch failed');
                }
            })
            .catch(error => {
                // Fallback: Show instructions
                const instructions = `
To launch Chrome with full camera and media permissions:

1. Run the Chrome launcher script:
   - Double-click: start-chrome.bat
   - Or run: start-my-os.bat

2. Manual Chrome command:
   "C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe" --unsafely-treat-insecure-origin-as-secure=http://localhost:2999 --user-data-dir=temp-profile --disable-web-security --allow-running-insecure-content http://localhost:2999

3. Current URL will be: ${currentUrl}
                `;
                
                alert(instructions);
                console.error('Chrome launch failed:', error);
            });
        }

        // ========== CALCULATOR FUNCTIONS ==========
        let calculatorExpression = '';
        let calculatorDisplay = '0';
        let lastResult = null;

        function updateCalculatorDisplay() {
            document.getElementById('calculator-display').textContent = calculatorDisplay;
        }

        function calculatorInput(value) {
            if (value === '¬±') {
                if (calculatorDisplay !== '0') {
                    calculatorDisplay = calculatorDisplay.startsWith('-') ? 
                        calculatorDisplay.substring(1) : '-' + calculatorDisplay;
                    updateCalculatorDisplay();
                }
                return;
            }
            
            if (['+', '-', '*', '/', '%'].includes(value)) {
                if (calculatorExpression && !['+', '-', '*', '/', '%'].includes(calculatorExpression.slice(-1))) {
                    calculatorExpression += value;
                    calculatorDisplay = '0';
                } else if (!calculatorExpression) {
                    calculatorExpression = calculatorDisplay + value;
                    calculatorDisplay = '0';
                }
            } else {
                if (calculatorDisplay === '0' || lastResult !== null) {
                    calculatorDisplay = value;
                    lastResult = null;
                } else {
                    calculatorDisplay += value;
                }
            }
            updateCalculatorDisplay();
        }

        function clearCalculator() {
            calculatorExpression = '';
            calculatorDisplay = '0';
            lastResult = null;
            updateCalculatorDisplay();
        }

        function calculateResult() {
            if (calculatorExpression) {
                try {
                    const fullExpression = calculatorExpression + calculatorDisplay;
                    const result = eval(fullExpression);
                    calculatorDisplay = result.toString();
                    calculatorExpression = '';
                    lastResult = result;
                    updateCalculatorDisplay();
                } catch (error) {
                    calculatorDisplay = 'Error';
                    calculatorExpression = '';
                    updateCalculatorDisplay();
                }
            }
        }

        // ========== CAMERA FUNCTIONS ==========
        let cameraStream = null;
        let photoCount = 0;

        async function startCamera() {
            try {
                const video = document.getElementById('camera-video');
                cameraStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { width: 640, height: 480 }, 
                    audio: false 
                });
                video.srcObject = cameraStream;
            } catch (error) {
                alert('Camera access denied or not available: ' + error.message);
            }
        }

        function stopCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
                document.getElementById('camera-video').srcObject = null;
            }
        }

        function takePhoto() {
            const video = document.getElementById('camera-video');
            const canvas = document.getElementById('camera-canvas');
            const photosDiv = document.getElementById('camera-photos');
            
            if (video.srcObject) {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0);
                
                // Convert to image and display
                const imageData = canvas.toDataURL('image/png');
                const img = document.createElement('img');
                img.src = imageData;
                img.style.cssText = 'width: 100px; height: 75px; object-fit: cover; border-radius: 5px; cursor: pointer;';
                img.onclick = () => {
                    const newWindow = window.open();
                    newWindow.document.write(`<img src="${imageData}" style="max-width: 100%; max-height: 100%;">`);
                };
                
                photosDiv.appendChild(img);
                photoCount++;
            } else {
                alert('Please start the camera first!');
            }
        }

        // ========== SCREENSHOT FUNCTION ==========
        async function takeScreenshot() {
            try {
                // Use html2canvas library or screen capture API
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                
                // Simple screenshot using canvas (limited functionality)
                const desktop = document.querySelector('.desktop');
                
                // Create a simple screenshot notification
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px;
                    border-radius: 8px;
                    z-index: 10000;
                    backdrop-filter: blur(10px);
                `;
                notification.innerHTML = 'üì∑ Screenshot saved! (Feature limited in browser)';
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 3000);
                
            } catch (error) {
                alert('Screenshot failed: ' + error.message);
            }
        }

        // ========== GAMES FUNCTIONS ==========
        let gameRunning = false;
        let currentGame = null;
        let gameCanvas, gameCtx;

        function initGameCanvas() {
            gameCanvas = document.getElementById('game-canvas');
            gameCtx = gameCanvas.getContext('2d');
            const gameArea = document.getElementById('game-area');
            gameCanvas.width = gameArea.clientWidth - 4;
            gameCanvas.height = gameArea.clientHeight - 4;
            gameCanvas.style.display = 'block';
            document.getElementById('game-start-screen').style.display = 'none';
        }

        // Snake Game
        let snake, food, direction, score;
        const gridSize = 20;

        function startSnakeGame() {
            if (gameRunning) return;
            
            currentGame = 'snake';
            gameRunning = true;
            initGameCanvas();
            
            // Initialize snake game
            snake = [{x: 200, y: 200}];
            food = {x: 300, y: 300};
            direction = {x: gridSize, y: 0};
            score = 0;
            
            gameLoop();
        }

        function gameLoop() {
            if (!gameRunning || currentGame !== 'snake') return;
            
            // Clear canvas
            gameCtx.fillStyle = '#000';
            gameCtx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
            
            // Move snake
            const head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};
            
            // Check wall collision
            if (head.x < 0 || head.x >= gameCanvas.width || head.y < 0 || head.y >= gameCanvas.height) {
                endGame('Game Over! Score: ' + score);
                return;
            }
            
            // Check self collision
            for (let segment of snake) {
                if (head.x === segment.x && head.y === segment.y) {
                    endGame('Game Over! Score: ' + score);
                    return;
                }
            }
            
            snake.unshift(head);
            
            // Check food collision
            if (head.x === food.x && head.y === food.y) {
                score++;
                food = {
                    x: Math.floor(Math.random() * (gameCanvas.width / gridSize)) * gridSize,
                    y: Math.floor(Math.random() * (gameCanvas.height / gridSize)) * gridSize
                };
            } else {
                snake.pop();
            }
            
            // Draw snake
            gameCtx.fillStyle = '#0f0';
            for (let segment of snake) {
                gameCtx.fillRect(segment.x, segment.y, gridSize - 2, gridSize - 2);
            }
            
            // Draw food
            gameCtx.fillStyle = '#f00';
            gameCtx.fillRect(food.x, food.y, gridSize - 2, gridSize - 2);
            
            // Draw score
            gameCtx.fillStyle = '#fff';
            gameCtx.font = '20px Arial';
            gameCtx.fillText('Score: ' + score, 10, 30);
            
            setTimeout(gameLoop, 150);
        }

        // Dino Game
        let dino, obstacles, dinoScore, isJumping;

        function startDinoGame() {
            if (gameRunning) return;
            
            currentGame = 'dino';
            gameRunning = true;
            initGameCanvas();
            
            // Initialize dino game
            dino = {x: 50, y: gameCanvas.height - 60, width: 40, height: 40, jumpHeight: 0, jumping: false};
            obstacles = [];
            dinoScore = 0;
            isJumping = false;
            
            dinoGameLoop();
        }

        function dinoGameLoop() {
            if (!gameRunning || currentGame !== 'dino') return;
            
            // Clear canvas
            gameCtx.fillStyle = '#87ceeb';
            gameCtx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
            
            // Draw ground
            gameCtx.fillStyle = '#8B4513';
            gameCtx.fillRect(0, gameCanvas.height - 20, gameCanvas.width, 20);
            
            // Update dino
            if (dino.jumping) {
                dino.jumpHeight += 8;
                if (dino.jumpHeight > 100) {
                    dino.jumping = false;
                }
            } else if (dino.jumpHeight > 0) {
                dino.jumpHeight -= 8;
            }
            
            // Draw dino
            gameCtx.fillStyle = '#0f0';
            gameCtx.fillRect(dino.x, dino.y - dino.jumpHeight, dino.width, dino.height);
            
            // Create obstacles
            if (Math.random() < 0.005) {
                obstacles.push({x: gameCanvas.width, y: gameCanvas.height - 40, width: 20, height: 20});
            }
            
            // Update and draw obstacles
            for (let i = obstacles.length - 1; i >= 0; i--) {
                obstacles[i].x -= 5;
                
                // Draw obstacle
                gameCtx.fillStyle = '#8B4513';
                gameCtx.fillRect(obstacles[i].x, obstacles[i].y, obstacles[i].width, obstacles[i].height);
                
                // Check collision
                if (obstacles[i].x < dino.x + dino.width && 
                    obstacles[i].x + obstacles[i].width > dino.x &&
                    obstacles[i].y < dino.y - dino.jumpHeight + dino.height &&
                    obstacles[i].y + obstacles[i].height > dino.y - dino.jumpHeight) {
                    endGame('Game Over! Score: ' + dinoScore);
                    return;
                }
                
                // Remove off-screen obstacles
                if (obstacles[i].x + obstacles[i].width < 0) {
                    obstacles.splice(i, 1);
                    dinoScore++;
                }
            }
            
            // Draw score
            gameCtx.fillStyle = '#000';
            gameCtx.font = '20px Arial';
            gameCtx.fillText('Score: ' + dinoScore, 10, 30);
            gameCtx.fillText('Press SPACE to jump', 10, gameCanvas.height - 100);
            
            requestAnimationFrame(dinoGameLoop);
        }

        function endGame(message) {
            gameRunning = false;
            alert(message);
            gameCanvas.style.display = 'none';
            document.getElementById('game-start-screen').style.display = 'block';
        }

        // Game controls
        document.addEventListener('keydown', (event) => {
            if (currentGame === 'snake' && gameRunning) {
                switch(event.key) {
                    case 'ArrowUp': if (direction.y === 0) direction = {x: 0, y: -gridSize}; break;
                    case 'ArrowDown': if (direction.y === 0) direction = {x: 0, y: gridSize}; break;
                    case 'ArrowLeft': if (direction.x === 0) direction = {x: -gridSize, y: 0}; break;
                    case 'ArrowRight': if (direction.x === 0) direction = {x: gridSize, y: 0}; break;
                }
            } else if (currentGame === 'dino' && gameRunning) {
                if (event.code === 'Space' && !dino.jumping && dino.jumpHeight === 0) {
                    dino.jumping = true;
                    event.preventDefault();
                }
            }
        });

        // ========== SCREEN SHARE FUNCTIONS ==========
        let screenShareStream = null;
        let mediaRecorder = null;
        let isRecording = false;
        let recordedChunks = [];
        let connectionId = null;

        // Desktop Screen Capture
        async function startDesktopCapture() {
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({ 
                    video: { 
                        width: { ideal: 1920, max: 1920 },
                        height: { ideal: 1080, max: 1080 },
                        frameRate: { ideal: 30, max: 60 }
                    },
                    audio: true
                });
                
                screenShareStream = stream;
                const video = document.getElementById('screenshare-video');
                video.srcObject = stream;
                video.style.display = 'block';
                
                document.getElementById('phone-content').style.display = 'none';
                updateConnectionStatus('Connected - Desktop Sharing', 'Sharing entire desktop screen');
                
                // Handle stream end
                stream.getVideoTracks()[0].onended = () => {
                    stopScreenShare();
                };
                
            } catch (error) {
                alert('Screen sharing failed: ' + error.message);
                updateConnectionStatus('Connection failed', error.message);
            }
        }

        // Stop screen sharing
        function stopScreenShare() {
            if (screenShareStream) {
                screenShareStream.getTracks().forEach(track => track.stop());
                screenShareStream = null;
            }
            
            const video = document.getElementById('screenshare-video');
            video.style.display = 'none';
            video.srcObject = null;
            
            document.getElementById('phone-content').style.display = 'block';
            updateConnectionStatus('Not connected', 'Ready to connect');
        }

        // Generate QR Code for mobile connection
        function generateQRCode() {
            const qrDiv = document.getElementById('qr-code');
            const connectionUrl = `${window.location.origin}/mobile-share?id=${Date.now()}`;
            
            // Simple QR code representation (in real implementation, use a QR library)
            qrDiv.innerHTML = `
                <div style="font-size: 48px; color: #333;">‚ñ†‚ñ°‚ñ†‚ñ°‚ñ†</div>
                <div style="font-size: 12px; color: #666; margin-top: 10px;">Scan to Connect</div>
                <div style="font-size: 10px; color: #999; margin-top: 5px; word-break: break-all;">${connectionUrl}</div>
            `;
            
            updateConnectionStatus('QR Code Generated', 'Waiting for mobile connection...');
        }

        // Create WebRTC connection
        function createConnection() {
            connectionId = 'room_' + Math.random().toString(36).substr(2, 9);
            document.getElementById('connection-id').value = connectionId;
            updateConnectionStatus('Room Created', `Room ID: ${connectionId}`);
        }

        // Join WebRTC connection
        function joinConnection() {
            const roomId = document.getElementById('connection-id').value;
            if (!roomId) {
                alert('Please enter a connection ID');
                return;
            }
            updateConnectionStatus('Joining Room', `Connecting to: ${roomId}`);
            // WebRTC connection logic would go here
        }

        // Toggle screen recording
        function toggleScreenRecord() {
            const recordBtn = document.getElementById('record-btn');
            
            if (!isRecording) {
                startRecording();
                recordBtn.innerHTML = '‚èπÔ∏è Stop Recording';
                recordBtn.style.background = '#f44336';
                isRecording = true;
            } else {
                stopRecording();
                recordBtn.innerHTML = 'üî¥ Start Recording';
                recordBtn.style.background = '#4caf50';
                isRecording = false;
            }
        }

        // Start recording
        async function startRecording() {
            if (!screenShareStream) {
                await startDesktopCapture();
            }
            
            if (screenShareStream) {
                recordedChunks = [];
                mediaRecorder = new MediaRecorder(screenShareStream, {
                    mimeType: 'video/webm;codecs=vp9'
                });
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `screen-recording-${new Date().getTime()}.webm`;
                    a.click();
                };
                
                mediaRecorder.start();
                updateConnectionStatus('Recording', 'Screen recording in progress...');
            }
        }

        // Stop recording
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                updateConnectionStatus('Recording Stopped', 'Video saved to downloads');
            }
        }

        // Take screenshot of shared screen
        function takeScreenshotPhone() {
            const video = document.getElementById('screenshare-video');
            if (!video.srcObject) {
                alert('No screen share active. Start sharing first!');
                return;
            }
            
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth || 1920;
            canvas.height = video.videoHeight || 1080;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            const imageData = canvas.toDataURL('image/png');
            
            // Add to gallery
            const gallery = document.getElementById('screenshot-gallery');
            const img = document.createElement('img');
            img.src = imageData;
            img.style.cssText = 'width: 60px; height: 40px; object-fit: cover; border-radius: 4px; cursor: pointer; border: 2px solid #007bff;';
            img.onclick = () => {
                const newWindow = window.open();
                newWindow.document.write(`<img src="${imageData}" style="max-width: 100%; max-height: 100%;">`);
            };
            
            gallery.appendChild(img);
            
            // Download screenshot
            const a = document.createElement('a');
            a.href = imageData;
            a.download = `screenshot-${new Date().getTime()}.png`;
            a.click();
            
            updateConnectionStatus('Screenshot Taken', 'Image saved to downloads and gallery');
        }

        // Fullscreen mode
        function fullscreenPhone() {
            const phoneFrame = document.getElementById('phone-frame');
            if (phoneFrame.requestFullscreen) {
                phoneFrame.requestFullscreen();
            } else if (phoneFrame.webkitRequestFullscreen) {
                phoneFrame.webkitRequestFullscreen();
            } else if (phoneFrame.msRequestFullscreen) {
                phoneFrame.msRequestFullscreen();
            }
        }

        // Update connection status
        function updateConnectionStatus(status, info = '') {
            document.getElementById('connection-status').textContent = status;
            document.getElementById('connection-info').textContent = info;
        }

        // Add Screen Share to start menu
        document.addEventListener('DOMContentLoaded', function() {
            // Add screen share to start menu
            const startMenu = document.getElementById('start-menu');
            const settingsItem = startMenu.querySelector('[onclick="openApp(\'settings\')"]:first-of-type');
            
            const screenShareItem = document.createElement('div');
            screenShareItem.className = 'start-menu-item';
            screenShareItem.onclick = () => openApp('screen-share');
            screenShareItem.innerHTML = '<span>üì±</span><span>Screen Share</span>';
            
            startMenu.insertBefore(screenShareItem, settingsItem);

            // Initialize system status panel
            initializeSystemStatus();
        });

        // ========== SYSTEM STATUS FUNCTIONS ==========
        let systemStatus = {
            battery: { level: 85, charging: false },
            hotspot: { enabled: false, devices: 0 },
            volume: 75,
            microphone: true,
            temperature: 42
        };

        function initializeSystemStatus() {
            // Start system status updates
            updateSystemStatus();
            setInterval(updateSystemStatus, 5000); // Update every 5 seconds
            
            // Hide system panel when clicking outside
            document.addEventListener('click', function(event) {
                const systemPanel = document.getElementById('system-panel');
                const systemTray = document.querySelector('.system-tray');
                
                if (!systemPanel.contains(event.target) && !systemTray.contains(event.target)) {
                    systemPanel.classList.remove('active');
                }
            });
        }

        function toggleSystemPanel() {
            const systemPanel = document.getElementById('system-panel');
            systemPanel.classList.toggle('active');
        }

        function updateSystemStatus() {
            // Try to get real battery status
            if ('getBattery' in navigator) {
                navigator.getBattery().then(battery => {
                    systemStatus.battery.level = battery.level * 100;
                    systemStatus.battery.charging = battery.charging;
                    updateBatteryDisplay();
                }).catch(() => {
                    // Fallback to simulation
                    simulateBattery();
                });
            } else {
                simulateBattery();
            }

            // Simulate temperature fluctuation
            systemStatus.temperature += (Math.random() - 0.5) * 4;
            systemStatus.temperature = Math.max(30, Math.min(80, systemStatus.temperature));

            // Update UI elements
            updateTemperatureDisplay();
            updateSystemTrayIcons();
        }

        function simulateBattery() {
            // Fallback simulation
            if (!systemStatus.battery.charging && systemStatus.battery.level > 0) {
                systemStatus.battery.level = Math.max(0, systemStatus.battery.level - Math.random() * 0.5);
            } else if (systemStatus.battery.charging && systemStatus.battery.level < 100) {
                systemStatus.battery.level = Math.min(100, systemStatus.battery.level + Math.random() * 2);
            }
            updateBatteryDisplay();
        }

        function updateBatteryDisplay() {
            const batteryFill = document.getElementById('battery-fill');
            const batteryPercentage = document.getElementById('battery-percentage');
            const batteryStatus = document.getElementById('battery-status');
            const batteryIcon = document.getElementById('battery-icon');
            
            const level = Math.round(systemStatus.battery.level);
            batteryFill.style.width = level + '%';
            batteryPercentage.textContent = level + '%';
            
            // Update battery color based on level
            if (level < 20) {
                batteryFill.style.background = 'linear-gradient(90deg, #f44336, #ff5722)';
                batteryIcon.className = 'system-tray-item critical';
                batteryStatus.textContent = 'Critical ‚Ä¢ Power saving mode';
            } else if (level < 50) {
                batteryFill.style.background = 'linear-gradient(90deg, #ff9800, #ffc107)';
                batteryIcon.className = 'system-tray-item low';
                const hours = Math.floor(level / 20);
                const minutes = Math.floor((level % 20) * 3);
                batteryStatus.textContent = `Low ‚Ä¢ ${hours}h ${minutes}m remaining`;
            } else {
                batteryFill.style.background = 'linear-gradient(90deg, #4caf50, #8bc34a)';
                batteryIcon.className = 'system-tray-item';
                const hours = Math.floor(level / 25);
                const minutes = Math.floor((level % 25) * 2.4);
                batteryStatus.textContent = `Good ‚Ä¢ ${hours}h ${minutes}m remaining`;
            }
        }

        function updateTemperatureDisplay() {
            const tempLevel = document.getElementById('temp-level');
            const cpuTemp = document.getElementById('cpu-temp');
            const tempIcon = document.getElementById('temperature-icon');
            
            const temp = Math.round(systemStatus.temperature);
            const tempPercent = Math.max(0, Math.min(100, ((temp - 30) / 50) * 100));
            
            tempLevel.style.height = (100 - tempPercent) + '%';
            cpuTemp.textContent = temp + '¬∞C';
            
            // Update temperature status
            if (temp > 70) {
                tempIcon.className = 'system-tray-item critical';
                tempIcon.nextElementSibling.textContent = 'CPU Hot';
            } else if (temp > 60) {
                tempIcon.className = 'system-tray-item low';
                tempIcon.nextElementSibling.textContent = 'CPU Warm';
            } else {
                tempIcon.className = 'system-tray-item';
                tempIcon.nextElementSibling.textContent = 'CPU Normal';
            }
        }

        function updateSystemTrayIcons() {
            // Update hotspot icon
            const hotspotIcon = document.getElementById('hotspot-icon');
            if (systemStatus.hotspot.enabled) {
                hotspotIcon.className = 'system-tray-item active';
            } else {
                hotspotIcon.className = 'system-tray-item';
            }

            // Update sound icon based on volume
            const soundIcon = document.getElementById('sound-icon');
            if (systemStatus.volume === 0) {
                soundIcon.textContent = 'üîá';
            } else if (systemStatus.volume < 30) {
                soundIcon.textContent = 'üîà';
            } else if (systemStatus.volume < 70) {
                soundIcon.textContent = 'üîâ';
            } else {
                soundIcon.textContent = 'üîä';
            }
        }

        function toggleHotspot() {
            const hotspotToggle = document.getElementById('hotspot-toggle');
            const hotspotStatus = document.getElementById('hotspot-status');
            
            systemStatus.hotspot.enabled = !systemStatus.hotspot.enabled;
            
            if (systemStatus.hotspot.enabled) {
                hotspotToggle.classList.add('active');
                systemStatus.hotspot.devices = Math.floor(Math.random() * 3) + 1;
                hotspotStatus.textContent = `Hotspot: On ‚Ä¢ ${systemStatus.hotspot.devices} device(s) connected`;
            } else {
                hotspotToggle.classList.remove('active');
                systemStatus.hotspot.devices = 0;
                hotspotStatus.textContent = 'Hotspot: Off ‚Ä¢ No devices connected';
            }
            
            updateSystemTrayIcons();
        }

        function updateVolume(value) {
            systemStatus.volume = parseInt(value);
            document.getElementById('volume-percentage').textContent = value + '%';
            updateSystemTrayIcons();
            
            // Simulate volume change feedback
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 20px;
                border-radius: 10px;
                z-index: 10000;
                backdrop-filter: blur(10px);
                font-size: 18px;
            `;
            notification.innerHTML = `üîä Volume: ${value}%`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 1000);
        }

        function toggleMicrophone() {
            const micToggle = document.getElementById('microphone-toggle');
            
            systemStatus.microphone = !systemStatus.microphone;
            
            if (systemStatus.microphone) {
                micToggle.classList.add('active');
            } else {
                micToggle.classList.remove('active');
            }
            
            // Show microphone status notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 20px;
                border-radius: 10px;
                z-index: 10000;
                backdrop-filter: blur(10px);
                font-size: 18px;
            `;
            notification.innerHTML = systemStatus.microphone ? 'üé§ Microphone: On' : 'üé§ Microphone: Off';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 1500);
        }

        // ========== WIFI SCANNING FUNCTIONS ==========
        function scanWifiNetworks() {
            const wifiStatus = document.getElementById('wifi-status');
            const wifiNetworks = document.getElementById('wifi-networks');
            
            wifiStatus.textContent = 'Scanning...';
            wifiNetworks.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.6); font-size: 12px; padding: 10px;">üîç Scanning for networks...</div>';
            
            // Simulate network scanning (in a real implementation, this would call an API)
            setTimeout(() => {
                const mockNetworks = generateMockWifiNetworks();
                displayWifiNetworks(mockNetworks);
                wifiStatus.textContent = `Found ${mockNetworks.length} networks`;
            }, 2000);
        }
        
        function generateMockWifiNetworks() {
            const networkNames = [
                'Home_WiFi_5G',
                'NETGEAR_24G', 
                'Linksys_Guest',
                'Office_Network',
                'Starbucks_WiFi',
                'iPhone_Hotspot',
                'TP-Link_Wireless',
                'ATT_WiFi_2.4G',
                'Samsung_Galaxy',
                'DIRECT-Router',
                'Public_WiFi',
                'MySpectrumWiFi94'
            ];
            
            const randomCount = Math.floor(Math.random() * 8) + 4; // 4-12 networks
            const networks = [];
            
            for (let i = 0; i < randomCount; i++) {
                const name = networkNames[Math.floor(Math.random() * networkNames.length)];
                const signalStrength = Math.floor(Math.random() * 4) + 1; // 1-4 bars
                const isSecure = Math.random() > 0.3; // 70% chance of being secure
                const frequency = Math.random() > 0.6 ? '5GHz' : '2.4GHz';
                
                networks.push({
                    name: name + (i > 0 ? '_' + i : ''),
                    signalStrength,
                    isSecure,
                    frequency,
                    connected: i === 0 && name.includes('Home') // First network is "connected"
                });
            }
            
            return networks.sort((a, b) => {
                if (a.connected) return -1;
                if (b.connected) return 1;
                return b.signalStrength - a.signalStrength;
            });
        }
        
        function displayWifiNetworks(networks) {
            const wifiNetworks = document.getElementById('wifi-networks');
            wifiNetworks.innerHTML = '';
            
            networks.forEach(network => {
                const networkDiv = document.createElement('div');
                networkDiv.style.cssText = `
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 6px;
                    margin-bottom: 4px;
                    background: ${network.connected ? 'rgba(76,175,80,0.2)' : 'rgba(255,255,255,0.05)'};
                    border-radius: 4px;
                    cursor: pointer;
                    transition: background 0.2s;
                    border-left: ${network.connected ? '3px solid #4caf50' : '3px solid transparent'};
                `;
                
                networkDiv.onmouseover = () => {
                    if (!network.connected) {
                        networkDiv.style.background = 'rgba(255,255,255,0.1)';
                    }
                };
                
                networkDiv.onmouseout = () => {
                    networkDiv.style.background = network.connected ? 'rgba(76,175,80,0.2)' : 'rgba(255,255,255,0.05)';
                };
                
                networkDiv.onclick = () => connectToWifi(network);
                
                const leftDiv = document.createElement('div');
                leftDiv.style.cssText = 'display: flex; flex-direction: column; flex: 1;';
                
                const nameDiv = document.createElement('div');
                nameDiv.style.cssText = `
                    font-size: 11px;
                    font-weight: 500;
                    color: ${network.connected ? '#4caf50' : 'white'};
                    margin-bottom: 2px;
                `;
                nameDiv.textContent = network.name + (network.connected ? ' (Connected)' : '');
                
                const infoDiv = document.createElement('div');
                infoDiv.style.cssText = 'font-size: 9px; opacity: 0.7; color: white;';
                infoDiv.textContent = `${network.frequency} ‚Ä¢ ${network.isSecure ? 'Secured' : 'Open'}`;
                
                leftDiv.appendChild(nameDiv);
                leftDiv.appendChild(infoDiv);
                
                const rightDiv = document.createElement('div');
                rightDiv.style.cssText = 'display: flex; align-items: center; gap: 4px;';
                
                // Signal strength indicator
                const signalIcon = getSignalIcon(network.signalStrength);
                rightDiv.innerHTML = `
                    <span style="font-size: 12px;">${signalIcon}</span>
                    <span style="font-size: 10px;">${network.isSecure ? 'üîí' : 'üîì'}</span>
                `;
                
                networkDiv.appendChild(leftDiv);
                networkDiv.appendChild(rightDiv);
                wifiNetworks.appendChild(networkDiv);
            });
        }
        
        function getSignalIcon(strength) {
            switch(strength) {
                case 4: return 'üì∂'; // Full signal
                case 3: return 'üì∂'; // Good signal 
                case 2: return 'üì∂'; // Fair signal
                case 1: return 'üì∂'; // Poor signal
                default: return 'üì∂';
            }
        }
        
        function connectToWifi(network) {
            if (network.connected) {
                // Show network details
                alert(`Connected to: ${network.name}\nFrequency: ${network.frequency}\nSecurity: ${network.isSecure ? 'WPA2/WPA3' : 'None'}\nSignal: Strong`);
                return;
            }
            
            if (network.isSecure) {
                const password = prompt(`Enter password for "${network.name}":`);
                if (!password) return;
                
                // Simulate connection attempt
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.9);
                    color: white;
                    padding: 20px 30px;
                    border-radius: 10px;
                    z-index: 10000;
                    backdrop-filter: blur(10px);
                    text-align: center;
                `;
                notification.innerHTML = `
                    <div style="font-size: 16px; margin-bottom: 10px;">üîÑ Connecting to ${network.name}...</div>
                    <div style="font-size: 12px; opacity: 0.8;">Please wait</div>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                    
                    // Simulate success/failure
                    if (Math.random() > 0.3) { // 70% success rate
                        showConnectionSuccess(network.name);
                        // Refresh the network list to show as connected
                        setTimeout(() => scanWifiNetworks(), 1000);
                    } else {
                        alert(`‚ùå Failed to connect to "${network.name}"\n\nPossible reasons:\n- Incorrect password\n- Network out of range\n- Authentication timeout`);
                    }
                }, 2000);
                
            } else {
                // Open network - connect immediately
                showConnectionSuccess(network.name);
                setTimeout(() => scanWifiNetworks(), 500);
            }
        }
        
        function showConnectionSuccess(networkName) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(76, 175, 80, 0.95);
                color: white;
                padding: 20px 30px;
                border-radius: 10px;
                z-index: 10000;
                backdrop-filter: blur(10px);
                text-align: center;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            notification.innerHTML = `
                <div style="font-size: 20px; margin-bottom: 10px;">‚úÖ</div>
                <div style="font-size: 16px; margin-bottom: 5px;">Connected Successfully!</div>
                <div style="font-size: 14px; opacity: 0.9;">"${networkName}"</div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }

        // ========== NOTEPAD FUNCTIONS ==========
        function newDocument() {
            document.getElementById('notepad-text').value = '';
            updateCharCount();
        }

        function saveDocument() {
            const text = document.getElementById('notepad-text').value;
            const filename = prompt('Enter filename (with .txt extension):') || 'document.txt';
            
            // Create and download the file
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            // Show save notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(76, 175, 80, 0.95);
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                z-index: 10000;
            `;
            notification.textContent = `üíæ Document saved as ${filename}`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 2000);
        }

        function loadDocument() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('notepad-text').value = e.target.result;
                        updateCharCount();
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function updateCharCount() {
            const text = document.getElementById('notepad-text').value;
            document.getElementById('char-count').textContent = text.length;
        }

        // Update character count as user types
        document.addEventListener('DOMContentLoaded', function() {
            const notepadText = document.getElementById('notepad-text');
            if (notepadText) {
                notepadText.addEventListener('input', updateCharCount);
            }
        });

        // ========== BROWSER2 FUNCTIONS (for apps menu browser) ==========
        function handleBrowserUrl2(event) {
            if (event.key === 'Enter') {
                navigateTo2();
            }
        }

        function navigateTo2() {
            const url = document.getElementById('browser-url2').value;
            const frame = document.getElementById('browser-frame2');
            
            if (url) {
                let targetUrl = url;
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    if (url.includes('.') && !url.includes(' ')) {
                        targetUrl = 'https://' + url;
                    } else {
                        targetUrl = 'https://www.google.com/search?q=' + encodeURIComponent(url);
                    }
                }
                frame.src = targetUrl;
            }
        }

        function browserBack2() {
            const frame = document.getElementById('browser-frame2');
            try {
                frame.contentWindow.history.back();
            } catch (e) {
                console.log('Cannot navigate back due to cross-origin restrictions');
            }
        }

        function browserForward2() {
            const frame = document.getElementById('browser-frame2');
            try {
                frame.contentWindow.history.forward();
            } catch (e) {
                console.log('Cannot navigate forward due to cross-origin restrictions');
            }
        }

        function browserRefresh2() {
            const frame = document.getElementById('browser-frame2');
            frame.src = frame.src;
        }

        // ========== PAINT FUNCTIONS ==========
        let isPainting = false;
        let paintCanvas, paintCtx;

        function initializePaint() {
            paintCanvas = document.getElementById('paint-canvas');
            if (!paintCanvas) return;
            
            paintCtx = paintCanvas.getContext('2d');
            const paintWindow = document.getElementById('paint-window');
            paintCanvas.width = paintWindow.clientWidth - 40;
            paintCanvas.height = paintWindow.clientHeight - 120;
            
            // Mouse events for painting
            paintCanvas.addEventListener('mousedown', startPainting);
            paintCanvas.addEventListener('mousemove', paint);
            paintCanvas.addEventListener('mouseup', stopPainting);
            paintCanvas.addEventListener('mouseout', stopPainting);
        }

        function startPainting(event) {
            isPainting = true;
            paint(event);
        }

        function paint(event) {
            if (!isPainting) return;
            
            const rect = paintCanvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            paintCtx.lineWidth = document.getElementById('brush-size').value;
            paintCtx.strokeStyle = document.getElementById('brush-color').value;
            paintCtx.lineCap = 'round';
            
            paintCtx.lineTo(x, y);
            paintCtx.stroke();
            paintCtx.beginPath();
            paintCtx.moveTo(x, y);
        }

        function stopPainting() {
            if (!isPainting) return;
            isPainting = false;
            paintCtx.beginPath();
        }

        function clearCanvas() {
            if (paintCtx) {
                paintCtx.clearRect(0, 0, paintCanvas.width, paintCanvas.height);
            }
        }

        function savePainting() {
            if (paintCanvas) {
                const imageData = paintCanvas.toDataURL('image/png');
                const a = document.createElement('a');
                a.href = imageData;
                a.download = `painting-${new Date().getTime()}.png`;
                a.click();
                
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(76, 175, 80, 0.95);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 8px;
                    z-index: 10000;
                `;
                notification.textContent = 'üé® Painting saved!';
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 2000);
            }
        }

        // ========== MUSIC PLAYER FUNCTIONS ==========
        let currentSongIndex = 0;
        let isPlaying = false;
        const playlist = [
            { title: 'Chill Vibes', artist: 'Lo-Fi Beats' },
            { title: 'Electronic Dreams', artist: 'Synth Wave' },
            { title: 'Nature Sounds', artist: 'Ambient' },
            { title: 'Retro Gaming', artist: 'Chiptune' }
        ];

        function selectSong(title, artist) {
            document.getElementById('current-song').textContent = title;
            document.getElementById('artist-name').textContent = artist;
            
            // Find and highlight selected song
            const songItems = document.querySelectorAll('.song-item');
            songItems.forEach(item => {
                item.style.background = '';
                if (item.textContent.includes(title)) {
                    item.style.background = 'rgba(102, 126, 234, 0.2)';
                }
            });
        }

        function togglePlayPause() {
            const playBtn = document.getElementById('play-pause-btn');
            const currentSong = document.getElementById('current-song').textContent;
            
            if (currentSong === 'No song selected') {
                // Auto-select first song
                selectSong(playlist[0].title, playlist[0].artist);
                currentSongIndex = 0;
            }
            
            isPlaying = !isPlaying;
            playBtn.textContent = isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
            playBtn.style.background = isPlaying ? '#ff9800' : '#4caf50';
            
            if (isPlaying) {
                // Simulate music progress
                simulateMusicProgress();
            }
        }

        function previousSong() {
            currentSongIndex = (currentSongIndex - 1 + playlist.length) % playlist.length;
            const song = playlist[currentSongIndex];
            selectSong(song.title, song.artist);
        }

        function nextSong() {
            currentSongIndex = (currentSongIndex + 1) % playlist.length;
            const song = playlist[currentSongIndex];
            selectSong(song.title, song.artist);
        }

        function simulateMusicProgress() {
            const progressBar = document.getElementById('music-progress');
            let progress = 0;
            
            const interval = setInterval(() => {
                if (!isPlaying) {
                    clearInterval(interval);
                    return;
                }
                
                progress += 1;
                progressBar.value = progress;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    nextSong();
                    if (isPlaying) {
                        setTimeout(simulateMusicProgress, 500);
                    }
                }
            }, 200);
        }

        // ========== PHOTOS FUNCTIONS ==========
        function uploadPhoto() {
            document.getElementById('photo-upload').click();
        }

        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    addPhotoToGallery(e.target.result, file.name);
                };
                reader.readAsDataURL(file);
            }
        }

        function addPhotoToGallery(imageSrc, filename) {
            const gallery = document.getElementById('photos-gallery');
            const photoDiv = document.createElement('div');
            photoDiv.className = 'photo-item';
            photoDiv.style.cssText = 'aspect-ratio: 1; border-radius: 8px; overflow: hidden; cursor: pointer; background: #f0f0f0;';
            
            const img = document.createElement('img');
            img.src = imageSrc;
            img.style.cssText = 'width: 100%; height: 100%; object-fit: cover;';
            img.onclick = () => viewPhoto(filename, imageSrc);
            
            photoDiv.appendChild(img);
            gallery.appendChild(photoDiv);
        }

        function takePhotoFromCamera() {
            // Open camera app to take photo
            openApp('camera');
            alert('üì∑ Camera app opened! Use "Take Photo" button in the camera app, then check the Photos app to view your images.');
        }

        function viewPhoto(filename, imageSrc = null) {
            const viewer = document.createElement('div');
            viewer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
            `;
            
            if (imageSrc) {
                viewer.innerHTML = `
                    <div style="text-align: center;">
                        <img src="${imageSrc}" style="max-width: 90%; max-height: 90%; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
                        <div style="color: white; margin-top: 20px; font-size: 18px;">${filename}</div>
                        <div style="color: rgba(255,255,255,0.7); margin-top: 10px; font-size: 14px;">Click anywhere to close</div>
                    </div>
                `;
            } else {
                viewer.innerHTML = `
                    <div style="text-align: center; color: white;">
                        <div style="font-size: 72px; margin-bottom: 20px;">üñºÔ∏è</div>
                        <div style="font-size: 24px; margin-bottom: 10px;">${filename}</div>
                        <div style="font-size: 16px; opacity: 0.7;">Sample image preview</div>
                        <div style="color: rgba(255,255,255,0.7); margin-top: 20px; font-size: 14px;">Click anywhere to close</div>
                    </div>
                `;
            }
            
            viewer.onclick = () => document.body.removeChild(viewer);
            document.body.appendChild(viewer);
        }

        function changePhotoView(mode) {
            const gallery = document.getElementById('photos-gallery');
            if (mode === 'list') {
                gallery.style.display = 'flex';
                gallery.style.flexDirection = 'column';
                gallery.style.gridTemplateColumns = 'none';
            } else {
                gallery.style.display = 'grid';
                gallery.style.flexDirection = 'initial';
                gallery.style.gridTemplateColumns = 'repeat(auto-fill, minmax(150px, 1fr))';
            }
        }

        // Initialize paint canvas when paint window opens
        const originalOpenApp = window.openApp;
        window.openApp = function(appName) {
            originalOpenApp(appName);
            
            // Initialize specific apps after opening
            if (appName === 'paint') {
                setTimeout(initializePaint, 100);
            }
        };

    </script>
</body>
</html>
